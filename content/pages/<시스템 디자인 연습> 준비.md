---
title: <시스템 디자인 연습> 준비
categories:
  - 백엔드
tags:
  - 부하테스트
date: 2023-11-11T21:39:59+09:00
draft: true
modified: 2023-12-29T03:00:41+09:00
featured: false
series: 시스템 디자인 연습
---
### 배경
개발자로서 전문성에 대한 고민을 지속해왔다. 백엔드 중에서도 특히 시스템 디자인에 관심이 갔으나, 접해볼 기회가 많지 않았다. 주로 책을 통해서만 학습하여 그 한계를 분명히 느끼고 있었다. 

### 목적
내가 설정한 목표는 명확하다. 시스템에 부하가 늘어날 때 발생하는 문제들을 직접 경험하고, 이를 효과적으로 해결할 수 있는 구조를 설계하는 것이다. 이 과정에서 실제로 시스템이 어떻게 반응하는지 관찰하고, 필요한 조치들을 실시간으로 적용해볼 계획이다.

### 방식
이 목표를 달성하기 위해, 나는 부하 테스트를 통해 가상의 트래픽을 생성하고, 시스템을 점진적으로 개선해나갈 것이다. 이러한 부하 테스트는 시스템의 한계를 파악하고, 문제를 해결하기 위한 다양한 접근 방식을 실험하는 데 도움을 줄 것이다.

작업
- [sample\_feed](https://github.com/chankoo/load-testing-practices/tree/main/sample_feed)
- [sample\_chat](https://github.com/chankoo/load-testing-practices/tree/main/sample_chat)


조건
1. api를 테스트
2. 분산 환경에서의 테스트를 포함해야함 

대상
1. 싱글 인스턴스
2. 일반적인 수준의 확장
	1. ALB
	2. ec2 scale out
	3. 캐싱
3. 분산 환경
	1. 메시지 큐로 서버 간 느슨한 결합
	2. db 샤딩
	3. 서비스 분리
	4. 고도화

과정
1. 부하 테스트 환경 세팅
	1. 부하 생성
	2. 모니터링
2. 목표치 설정. Throughput, Latency 
3. 샘플 앱 결정

### 환경
- python django gunicorn
	- 나에게 가장 익숙한 스택을 사용하여 빠르게 구현하고자 한다. 이 스택은 안정성과 편리함을 제공하여 개발에 집중할 수 있게 해준다.
- python fastapi uvicorn
	- 
- docker-compose
	- 개발 환경 설정에 익숙하며, 여러 컴포넌트를 빠르고 효율적으로 실험하고 테스트하는 데 적합하다고 판단했다.

### 부하테스트 세팅
- k6 + grafana + influxdb
	- 가벼우면서 러닝 커브가 낮은 k6 를 선택했다. 
	- 테스트 결과를 시각화하는 일에 큰 리소스를 쓰고 싶지 않았다. 마침 k6는 grafana, influxdb 를 이용한 대시보드 템플릿이 이미 잘 만들어져있어 적합했다.
	- javascript 로 테스트 시나리오를 작성할 수 있어 익숙한 탓도 컸다.
	- 그밖에 고려한 툴
		- JMeter, nGrinder 등도 많이 쓰이지만 간단한 부하 생성용으로는 무거워보였고, 러닝 커브가 상대적으로 높다고 판단했다.
		- locust는 파이썬 기반의 툴이라 반가웠지만, 신뢰가 가는 예제와 레퍼런스를 찾기가 상대적으로 어렵다는 느낌이 들었다.
- 지표
	- RPS
	- 요청 실패 비율
	- 요청 처리 시간
	- 요청 전 차단 시간
	- cpu 사용량
	- 메모리 사용량
	- 네트워크 처리량

이번 프로젝트는 단순히 시스템 디자인에 대한 이해를 넘어, 실제 환경에서의 문제 해결 능력을 키우는 데 중점을 둔다. 이 과정을 통해 나는 더 나은 백엔드 개발자로 성장할 수 있을 것이며, 이 경험은 앞으로의 개발 여정에 큰 도움이 될 것이다.


## refs
- [[가상 면접 사례로 배우는 대규모 시스템 설계 기초]]
- [서버 사이드 테스트 자동화 여정 - 4. 성능 테스트 자동화 목표 설정 및 테스트 환경 구성](https://engineering.linecorp.com/ko/blog/server-side-test-automation-4)
- [대용량 트래픽은 어떻게 테스트해야할까? 60만 RPM 테스트하기 by 스케일아웃 (K6, AWS, EC2, 테스트, 성능테스트)](https://vince-kim.tistory.com/39)
- [GitHub - schooldevops/k6-tutorials](https://github.com/schooldevops/k6-tutorials)

